<div data---="largeform__common.form__if:collectionform;icon:fal fa-box;autofocus:true;reload:collectionform/reload;scrollbar:1;submit:collectionform/submit;width:600" class="hidden">

	<div data-scope="collectionform">
		<div class="padding">

			<div data---="input__?.name__required:1;maxlength:80__''">@(Name)</div>
			<div class="help m">@(Type a name for this collection)</div>

			<hr />

			<div class="row">
				<div class="col-sm-4 m">
					<div data---="input__?.icon__type:icon__'far fa-book'">@(Icon)</div>
				</div>
				<div class="col-sm-4 m">
					<div data---="input__?.color__type:color__''">@(Color)</div>
				</div>
			</div>
		</div>
		<hr class="nmt nmb" />
		<div class="padding">

			<div class="m mt5">
				<div data---="checkbox__?.isopen__null__true">@(Show documents from this collection in the open documents)</div>
			</div>

			<div class="panel">
				<label><i class="far fa-lock-alt"></i>@(Permissions)</label>
				<div class="padding">
					<div data---="textboxlist__?.groups__placeholder:@(Type a group name and press enter)__[]">@(Groups)</div>
					<div class="help m"><span class="link exec" data-exec="?/findgroup"><i class="fas fa-search"></i>@(Find group)</span></div>
					<div data---="textboxlist__?.roles__placeholder:@(Type a role name and press enter)__[]">@(Roles)</div>
					<div class="help"><span class="link exec" data-exec="?/findrole"><i class="fas fa-search"></i>@(Find role)</span></div>
				</div>
			</div>

		</div>
	</div>
	<nav data---="validation__collectionform">
		<button name="submit" disabled><i class="far fa-check-circle"></i>@(SUBMIT)</button>
		<button name="cancel">@(Cancel)</button>
	</nav>
</div>

<script>

	PLUGIN('collectionform', function(exports) {

		exports.reload = function(com) {
			var model = GET('?');
			var id = model ? model.id : null;
			com.reconfigure({ title: id ? '@(Update collection)' : '@(Create collection)' });
		};

		exports.findgroup = function(el) {
			var opt = {};
			opt.element = el;
			opt.items = common.groups;
			opt.callback = function(value) {
				if (value) {
					var arr = GET('?.groups');
					if (arr.indexOf(value.id) === -1)
						PUSH('?.groups', value.id);
				}
			};
			SETTER('directory/show', opt);
		};

		exports.findrole = function(el) {
			var opt = {};
			opt.element = el;
			opt.items = common.roles;
			opt.callback = function(value) {
				if (value) {
					var arr = GET('?.roles');
					if (arr.indexOf(value.id) === -1)
						PUSH('?.roles', value.id);
				}
			};
			SETTER('directory/show', opt);
		};

		exports.submit = function(hide) {
			var model = GET('? @reset');
			SETTER('loading/show');
			AJAX('POST /api/collections/' + (model.id || ''), model, ASETTER('message/response', function(response) {
				FUNC.updateroles(model);
				FUNC.updategroups(model);
				SETTER('loading/hide', 500);
				EXEC('common/refresh');
				hide();
			}));
		};
	});

</script>