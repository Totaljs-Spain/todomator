<div data---="centered__common.form__if:loginwindow;closeesc:0;closebutton:0;reload:loginwindow/reload;scrollbar:1;class:loginbg" class="hidden">
	<div class="padding">
		<br />
		<div data-scope="loginwindow__null__{}" style="text-align:left">

			<div class="signin-form" data-bind="?.page__show:value==='login'" style="max-width:350px;width:100%;margin:0 auto">
				<div class="form panel">
					<label><i class="far fa-lock-alt"></i>@(Sign-in)</label>
					<div data-scope="login" class="padding">

						<div class="alert m hidden" data-bind="common.initcredentials__show">
							<div class="m"><i class="fa fa-lock"></i>@(Your default credentials are below. You can change them after you sign in.)</div>
							<div class="keyvalue">
								<div class="key">@(Name)</div>
								<div class="value b" data-bind="common.initcredentials.email__text"></div>
							</div>
							<div class="keyvalue">
								<div class="key">@(Password)</div>
								<div class="value b" data-bind="common.initcredentials.password__text"></div>
							</div>
						</div>

						<div data---="enter__?">
							<div data---="input__?.email__type:email;required:1;$id:signup_logininput__'@'" class="m">@(E-mail address)</div>
							<div data---="input__?.password__type:password;required:1;maxlength:30__''" class="m">@(Password)</div>

							<nav class="links m">
								<span class="exec" data-exec="?1/reset"><i class="fa fa-caret-right"></i>@(Reset password)</span>
							</nav>

							<div data---="validation__?">
								<button class="button b exec" name="submit" disabled data-exec="?1/login_submit">@(Sign in)</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="passwordreset-form" data-bind="?.page__show:value==='reset'" style="max-width:350px;width:100%;margin:0 auto">
				<div class="form panel">
					<label><i class="far fa-envelope"></i>@(Reset password)</label>
					<div data-scope="reset" class="padding">
						<div data---="enter__?">
							<div data---="input__?.email__type:email;required:1;$id:signup_resetinput__'@'" class="m">@(E-mail address)</div>

							<nav class="links m">
								<span class="exec" data-exec="?1/login"><i class="fa fa-caret-right"></i>@(Back to login form)</span>
							</nav>

							<div data---="validation__?">
								<button class="button b exec" name="submit" disabled data-exec="?1/reset_submit">@(Reset)</button>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>

<script>

	PLUGIN('loginwindow', function(exports) {

		var cl = false;

		exports.reload = function(com) {
			exports.login();
		};

		exports.login = function() {

			!isMOBILE && FIND('#signup_logininput', function(com) {
				setTimeout(function() {
					com.find('input').focus();
				}, 1000);
			});

			SET('?.page', 'login');
		};

		exports.login_submit = function() {
			var model = GETR('?.login');
			AJAX('POST /api/account/login/', model, ASETTER('message/response', function(response) {
				location.href = '/';
			}));
		};

		exports.create = function() {

			!isMOBILE && FIND('#signup_createinput', function(com) {
				setTimeout(function() {
					com.find('input').focus();
				}, 1000);
			});

			if (!cl) {
				cl = true;
				AJAX('GET /api/cl/', 'common.cl');
			}

			NUL('?.create.code');
			SET('?.page', 'create');
		};

		exports.create_submit = function() {
			var model = GETR('?.create');
			model.sessionid = common.sessionid;
			AJAX('POST /api/account/create/', model, ASETTER('message/response', function(response) {

				REWRITE('?.create.code', '');
				SET('?.smscode.code', '');

				if (response.value === 'smscode') {
					SET('?.smscode', { phone: model.phone, type: 'create' });
					SET('loginwindow.page', 'smscode');
					SETTER('#signuppin/focus');
				} else
					location.href = '/?newbie=1';
			}));
		};

		exports.reset_submit = function() {
			var model = GETR('?.reset');
			model.sessionid = common.sessionid;
			AJAX('POST /api/account/reset/', model, ASETTER('message/response', function(response) {

				REWRITE('?.reset.code', '');
				SET('?.smscode.code', '');

				if (response.value === 'smscode') {
					SET('?.smscode', { type: 'reset' });
					SET('loginwindow.page', 'smscode');
					SETTER('#signuppin/focus');
				} else
					location.href = '/?password=1';
			}));
		};

		exports.reset = function() {

			!isMOBILE && FIND('#signup_resetinput', function(com) {
				setTimeout(function() {
					com.find('input').focus();
				}, 1000);
			});

			NUL('?.reset.code');
			SET('?.page', 'reset');
		};

		WATCH('?.smscode.code', function(path, value) {
			if (value && value.trim().length === 5) {
				var data = GET('?.smscode');
				switch (data.type) {
					case 'create':
						SET('?.create.code', value);
						exports.create_submit();
						break;
					case 'reset':
						SET('?.reset.code', value);
						exports.reset_submit();
						break;
				}
			}
		});

	});

</script>