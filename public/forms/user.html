<div data---="largeform__common.form2__if:~PATH~;icon:far fa-cog;autofocus:true;scrollbar:1;reload:?/reload;submit:?/submit;width:600;zindex:20" class="hidden" data-scope="~PATH~">

	<div class="~PATH~">

		<div class="bg-smoke" style="padding:30px 0">
			<div class="photo exec pointer" data-exec="?/upload"><img data-bind="?__src:value.photo?value.photo:Thelpers.initialsbase64(value.name || 'Todomator',300,300);track:photo" alt="@(Photo)" class="img-responsive" /></div>
			<div class="help center exec pointer" data-exec="?/upload"><i class="fa fa-cloud-upload"></i>@(Upload photo - 300x300 pixels)</div>
		</div>

		<div class="padding">

			<div class="m">
				<div data---="radiobutton__?.gender__items:@(Male)|male,@(Female)|female__'male'"></div>
			</div>

			<div class="row">
				<div class="col-xs-6 m">
					<div data---="input__?.firstname__required:1;maxlength:30;$id:signup_createinput__''">@(First name)</div>
				</div>
				<div class="col-xs-6 m">
					<div data---="input__?.lastname__required:1;maxlength:30__''">@(Last name)</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-6 m">
					<div data---="input__?.position__required:1__''">@(Position)</div>
				</div>
				<div class="col-md-6 m">
					<div data---="input__?.email__type:email;required:1__'@'">@(E-mail address)</div>
				</div>
			</div>

			<div data---="checkbox__?.sa__null__false" class="b">@(Super administrator)</div>
			<div data---="checkbox__?.inactive__null__false">@(User is inactive)</div>
			<div data---="checkbox__?.ispassword__null__false">@(Change password)</div>
			<div data---="checkbox__?.welcome">@(Send welcome mail message)</div>
			<br />

			<div class="hidden m" data-bind="?.ispassword__show">
				<hr class="nmt" />
				<div data---="input__?.password__camouflage:â€¢;required:1;maxlength:30__''">@(New password)</div>
				<div class="help"><span class="link exec" data-exec="?/password">@(Generate password)</span></div>
			</div>
			<div class="panel m">
				<label class="bg-smoke"><i class="far fa-lock-alt"></i>@(Permissions)</label>
				<div class="padding">
					<div data---="textboxlist__?.groups__placeholder:@(Type a group name and press enter)__[]">@(Groups)</div>
					<div class="help m"><span class="link exec" data-exec="?/findgroup"><i class="fas fa-search"></i>@(Find group)</span></div>
					<div data---="textboxlist__?.roles__placeholder:@(Type a role name and press enter)__[]">@(Roles)</div>
					<div class="help"><span class="link exec" data-exec="?/findrole"><i class="fas fa-search"></i>@(Find role)</span></div>
				</div>
			</div>
		</div>
		<div class="padding bg-smoke npb">
			<div class="row">
				<div class="col-md-4 col-xs-6 m">
					<div data---="input__?.countryid__required:1;dirsource:common.cl.countries__''">@(Country)</div>
				</div>
				<div class="col-md-4 col-xs-6 m">
					<div data---="input__?.languageid__required:1;dirsource:common.cl.languages__''">@(Language)</div>
				</div>
				<div class="col-md-4 col-xs-6 m">
					<div data---="input__?.currencyid__required:1;dirsource:common.cl.currencies__''">@(Currency)</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4 col-xs-6 m">
					<div class="label">@(Theme):</div>
					<div data---="radiobuttonexpert__?.theme__datasource:%themes__0">
						<script type="text/html">
							<div class="radiobutton-item">
								<i class="{{ icon }}"></i>
								<span>{{ name }}</span>
							</div>
						</script>
					</div>
				</div>
				<div class="col-md-4 col-xs-6 m">
					<div class="label">@(Date format):</div>
					<div data---="radiobuttonexpert__?.dateformat__datasource:%dateformats">
						<script type="text/html">
							<div class="radiobutton-item">
								<i class="far fa-calendar"></i>
								<span>{{ name }}</span>
							</div>
						</script>
					</div>
				</div>
				<div class="col-md-4 col-xs-6 m">
					<div class="label">@(Number format):</div>
					<div data---="radiobuttonexpert__?.numberformat__datasource:%numberformats">
						<script type="text/html">
							<div class="radiobutton-item">
								<i class="far fa-calculator"></i>
								<span>{{ name }}</span>
							</div>
						</script>
					</div>
				</div>
			</div>
			<hr class="nmt" />
			<div data---="radiobutton__?.timeformat__items:@(24 hours)|24,@(12 hours)|12;type:number" class="m pull-left">@(Time format):</div>
			<div data---="radiobutton__?.datefirst__items:@(Sunday)|0,@(Monday)|1;type:number__1" class="m pull-left" style="margin-left:20px">@(First day of week):</div>
			<div class="clearfix"></div>
		</div>
	</div>
	<nav data---="validation__?">
		<button name="submit" disabled><i class="far fa-check-circle"></i>@(SUBMIT)</button>
		<button name="cancel">@(Cancel)</button>
	</nav>
</div>

<script>

	SET('%themes', [{ id: 0, name: '@(Light)', icon: 'fal fa-adjust' }, { id: 1, name: '@(Dark)', icon: 'far fa-adjust' }, { id: 2, name: '@(Auto)', icon: 'far fa-clock' }]);
	SET('%dateformats', [{ id: 'yyyy-MM-dd', name: NOW.format('yyyy-MM-dd') }, { id: 'dd.MM.yyyy', name: NOW.format('dd.MM.yyyy') }, { id: 'MM.dd.yyyyy', name: NOW.format('MM.dd.yyyy') }]);
	SET('%numberformats', [{ id: 0, name: '1 000.00' }, { id: 1, name: '1 000,00' }, { id: 2, name: '1,000.00' }, { id: 3, name: '1.000,00' }]);

	PLUGIN('~PATH~', function(exports) {

		exports.reload = function(com) {
			var model = GET('?');
			var id = model ? model.id : null;
			com.reconfigure({ title: id ? '@(Update user)' : '@(Create user)' });
		};

		exports.findgroup = function(el) {
			var opt = {};
			opt.element = el;
			opt.items = common.groups;
			opt.callback = function(value) {
				if (value) {
					var arr = GET('?.groups');
					if (arr.indexOf(value.id) === -1)
						PUSH('?.groups', value.id);
				}
			};
			SETTER('directory/show', opt);
		};

		exports.findrole = function(el) {
			var opt = {};
			opt.element = el;
			opt.items = common.roles;
			opt.callback = function(value) {
				if (value) {
					var arr = GET('?.roles');
					if (arr.indexOf(value.id) === -1)
						PUSH('?.roles', value.id);
				}
			};
			SETTER('directory/show', opt);
		};

		exports.submit = function(hide) {
			var model = GET('? @reset');
			SETTER('loading/show');
			AJAX('POST /api/users/' + (model.id || ''), model, ASETTER('message/response', function(response) {
				FUNC.updateroles(model);
				FUNC.updategroups(model);
				EXEC('users/refresh');
				SETTER('loading/hide', 1000);
				hide();
			}));
		};

		exports.password = function() {
			SET('?.password', GUID(15), 'show');
		};

		exports.upload = function() {
			var opt = {};
			opt.width = 300;
			opt.height = 300;
			opt.url = '/api/upload/base64/';
			opt.background = '#FFFFFF';
			opt.multiple = false;
			opt.callback = function(response, err) {
				if (response && response[0])
					SET('?.photo', response[0]);
			};
			SETTER('imageuploader/upload', opt);
		};
	});

</script>